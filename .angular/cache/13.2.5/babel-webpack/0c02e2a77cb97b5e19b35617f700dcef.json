{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { Notifications } from 'med-ai-common';\nimport { LabelDialogComponent } from '../label-dialog/label-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/model.service\";\nimport * as i2 from \"../services/study.service\";\nimport * as i3 from \"../services/eval.service\";\nimport * as i4 from \"../services/notification.service\";\nimport * as i5 from \"ngx-device-detector\";\nimport * as i6 from \"@angular/material/dialog\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/flex-layout/flex\";\nimport * as i9 from \"@angular/material/form-field\";\nimport * as i10 from \"@angular/material/input\";\nimport * as i11 from \"@angular/forms\";\nimport * as i12 from \"@angular/material/button\";\nimport * as i13 from \"@angular/material/table\";\nimport * as i14 from \"../model-dropdown/model-dropdown.component\";\nimport * as i15 from \"@angular/material/icon\";\nimport * as i16 from \"@angular/material/paginator\";\n\nfunction StudiesComponent_div_0_th_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Study \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r18 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r18.orthancStudyId, \" \");\n  }\n}\n\nfunction StudiesComponent_div_0_th_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Study Type\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r19 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r19.type, \" \");\n  }\n}\n\nfunction StudiesComponent_div_0_th_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Modality\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r20 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r20.modality, \" \");\n  }\n}\n\nfunction StudiesComponent_div_0_th_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Series UId\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r21 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r21.seriesUid, \" \");\n  }\n}\n\nfunction StudiesComponent_div_0_th_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Model \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵelement(1, \"app-model-dropdown\", 22);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r22 = ctx.$implicit;\n    const models_r1 = i0.ɵɵnextContext().ngIf;\n    const ctx_r11 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"modelFormControl\", ctx_r11.modelControls[element_r22.orthancStudyId])(\"models\", models_r1)(\"studyType\", element_r22.type);\n  }\n}\n\nfunction StudiesComponent_div_0_th_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"Start\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 21)(1, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function StudiesComponent_div_0_td_27_Template_button_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r26);\n      const element_r24 = restoredCtx.$implicit;\n      const ctx_r25 = i0.ɵɵnextContext(2);\n      return ctx_r25.startEval(element_r24);\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"play_arrow\");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction StudiesComponent_div_0_th_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"Delete\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction StudiesComponent_div_0_td_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r29 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 21)(1, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function StudiesComponent_div_0_td_30_Template_button_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r29);\n      const element_r27 = restoredCtx.$implicit;\n      const ctx_r28 = i0.ɵɵnextContext(2);\n      return ctx_r28.deleteStudy(element_r27);\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"delete\");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction StudiesComponent_div_0_tr_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 24);\n  }\n}\n\nfunction StudiesComponent_div_0_tr_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 25);\n  }\n}\n\nconst _c0 = function () {\n  return [10, 5, 20];\n};\n\nfunction StudiesComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r32 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 3)(3, \"mat-form-field\", 4)(4, \"mat-label\");\n    i0.ɵɵtext(5, \"Search\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"input\", 5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function StudiesComponent_div_0_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r32);\n      const ctx_r31 = i0.ɵɵnextContext();\n      return ctx_r31.openAddLabels();\n    });\n    i0.ɵɵtext(8, \"Add Labels\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"table\", 7);\n    i0.ɵɵelementContainerStart(10, 8);\n    i0.ɵɵtemplate(11, StudiesComponent_div_0_th_11_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(12, StudiesComponent_div_0_td_12_Template, 2, 1, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(13, 11);\n    i0.ɵɵtemplate(14, StudiesComponent_div_0_th_14_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(15, StudiesComponent_div_0_td_15_Template, 2, 1, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(16, 12);\n    i0.ɵɵtemplate(17, StudiesComponent_div_0_th_17_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(18, StudiesComponent_div_0_td_18_Template, 2, 1, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(19, 13);\n    i0.ɵɵtemplate(20, StudiesComponent_div_0_th_20_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(21, StudiesComponent_div_0_td_21_Template, 2, 1, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(22, 14);\n    i0.ɵɵtemplate(23, StudiesComponent_div_0_th_23_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(24, StudiesComponent_div_0_td_24_Template, 2, 3, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(25, 15);\n    i0.ɵɵtemplate(26, StudiesComponent_div_0_th_26_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(27, StudiesComponent_div_0_td_27_Template, 4, 0, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(28, 16);\n    i0.ɵɵtemplate(29, StudiesComponent_div_0_th_29_Template, 2, 0, \"th\", 9);\n    i0.ɵɵtemplate(30, StudiesComponent_div_0_td_30_Template, 4, 0, \"td\", 10);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵtemplate(31, StudiesComponent_div_0_tr_31_Template, 1, 0, \"tr\", 17);\n    i0.ɵɵtemplate(32, StudiesComponent_div_0_tr_32_Template, 1, 0, \"tr\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"mat-paginator\", 19);\n    i0.ɵɵlistener(\"page\", function StudiesComponent_div_0_Template_mat_paginator_page_33_listener($event) {\n      i0.ɵɵrestoreView(_r32);\n      const ctx_r33 = i0.ɵɵnextContext();\n      return ctx_r33.page($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.searchControl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"dataSource\", ctx_r0.studies);\n    i0.ɵɵadvance(22);\n    i0.ɵɵproperty(\"matHeaderRowDef\", ctx_r0.displayedColumns);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matRowDefColumns\", ctx_r0.displayedColumns);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"pageSizeOptions\", i0.ɵɵpureFunction0(6, _c0))(\"length\", ctx_r0.totalStudies);\n  }\n}\n\nexport let StudiesComponent = /*#__PURE__*/(() => {\n  class StudiesComponent {\n    constructor(modelService, studyService, evalService, notificationService, deviceService, dialog) {\n      this.modelService = modelService;\n      this.studyService = studyService;\n      this.evalService = evalService;\n      this.notificationService = notificationService;\n      this.deviceService = deviceService;\n      this.dialog = dialog;\n      this.studies = [];\n      this.modelControls = {};\n      this.models$ = this.modelService.getModels();\n      this.displayedColumns = [];\n      this.totalStudies = 0;\n      this.searchControl = new FormControl('');\n      this.orthancStudyCount$ = this.studyService.countOrthancStudies();\n      this.pageIndex = 0;\n      this.pageSize = 10;\n    }\n\n    ngOnInit() {\n      this.fetchStudies(this.pageIndex, this.pageSize);\n      this.searchControl.valueChanges.subscribe(s => {\n        if (this.paginator) {\n          this.paginator.pageIndex = 0;\n        }\n\n        this.fetchStudies(this.pageIndex, this.pageSize);\n      });\n      this.setupColumns();\n      this.notificationService.watchNotificationTypes([Notifications.studyReady]).subscribe(n => this.fetchStudies(this.pageIndex, this.pageSize));\n    }\n\n    setupColumns() {\n      let mobileColumns = ['seriesUid', 'model'];\n      let extraColumns = ['modality', 'studyType'];\n      let actionColumn = ['submit', 'delete'];\n\n      if (this.deviceService.isMobile()) {\n        this.displayedColumns = mobileColumns.concat(actionColumn);\n      } else {\n        this.displayedColumns = mobileColumns.concat(extraColumns, actionColumn);\n      }\n    }\n\n    startEval(study) {\n      let model = this.modelControls[study.orthancStudyId].value;\n      this.evalService.evalDicom(model, study.id).subscribe(res => this.notificationService.showNotification(`Sent request for evaluation of study ${study.id}`));\n    }\n\n    page(pageEvent) {\n      this.fetchStudies(pageEvent.pageIndex, pageEvent.pageSize);\n      this.pageSize = pageEvent.pageSize;\n      this.pageIndex = pageEvent.pageIndex;\n    }\n\n    fetchStudies(pageIndex, pageSize) {\n      this.studyService.getStudies(pageIndex, pageSize, this.searchControl.value).subscribe(studies => {\n        studies.payload.forEach(s => {\n          this.modelControls[s.orthancStudyId] = new FormControl('');\n        });\n        this.totalStudies = studies.total;\n        this.studies = studies.payload;\n      });\n    }\n\n    deleteStudy(study) {\n      this.studyService.deleteStudy(study.id).subscribe(res => this.notificationService.showNotification(`deleted study ${study.id}`));\n    }\n\n    openAddLabels() {\n      const dialogRef = this.dialog.open(LabelDialogComponent, {});\n    }\n\n  }\n\n  StudiesComponent.ɵfac = function StudiesComponent_Factory(t) {\n    return new (t || StudiesComponent)(i0.ɵɵdirectiveInject(i1.ModelService), i0.ɵɵdirectiveInject(i2.StudyService), i0.ɵɵdirectiveInject(i3.EvalService), i0.ɵɵdirectiveInject(i4.NotificationService), i0.ɵɵdirectiveInject(i5.DeviceDetectorService), i0.ɵɵdirectiveInject(i6.MatDialog));\n  };\n\n  StudiesComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: StudiesComponent,\n    selectors: [[\"app-studies\"]],\n    viewQuery: function StudiesComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(MatPaginator, 7);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.paginator = _t.first);\n      }\n    },\n    decls: 2,\n    vars: 3,\n    consts: [[\"fxLayoutAlign\", \"center center\", \"fxLayout\", \"column\", 4, \"ngIf\"], [\"fxLayoutAlign\", \"center center\", \"fxLayout\", \"column\"], [1, \"mat-elevation-z8\", \"start-eval-table\"], [1, \"search-bar\"], [\"fxFill\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Search\", 3, \"formControl\"], [\"mat-button\", \"\", 1, \"add-label-button\", 3, \"click\"], [\"mat-table\", \"\", 1, \"start-eval-table\", \"component-background\", 3, \"dataSource\"], [\"matColumnDef\", \"study\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [\"matColumnDef\", \"studyType\"], [\"matColumnDef\", \"modality\"], [\"matColumnDef\", \"seriesUid\"], [\"matColumnDef\", \"model\"], [\"matColumnDef\", \"submit\"], [\"matColumnDef\", \"delete\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"showFirstLastButtons\", \"\", 3, \"pageSizeOptions\", \"length\", \"page\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [3, \"modelFormControl\", \"models\", \"studyType\"], [\"mat-button\", \"\", \"type\", \"submit\", 3, \"click\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]],\n    template: function StudiesComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, StudiesComponent_div_0_Template, 34, 7, \"div\", 0);\n        i0.ɵɵpipe(1, \"async\");\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.models$));\n      }\n    },\n    directives: [i7.NgIf, i8.DefaultLayoutAlignDirective, i8.DefaultLayoutDirective, i9.MatFormField, i8.FlexFillDirective, i9.MatLabel, i10.MatInput, i11.DefaultValueAccessor, i11.NgControlStatus, i11.FormControlDirective, i12.MatButton, i13.MatTable, i13.MatColumnDef, i13.MatHeaderCellDef, i13.MatHeaderCell, i13.MatCellDef, i13.MatCell, i14.ModelDropdownComponent, i15.MatIcon, i13.MatHeaderRowDef, i13.MatHeaderRow, i13.MatRowDef, i13.MatRow, i16.MatPaginator],\n    pipes: [i7.AsyncPipe],\n    styles: [\".viewport[_ngcontent-%COMP%]{height:100%;width:100%}.item[_ngcontent-%COMP%]{height:20px;width:100%}.start-eval-table[_ngcontent-%COMP%]{width:100%}.search-bar[_ngcontent-%COMP%]{padding:1rem}.table-header[_ngcontent-%COMP%]{text-align:center}.add-label-button[_ngcontent-%COMP%]{width:100%}\"]\n  });\n  return StudiesComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}