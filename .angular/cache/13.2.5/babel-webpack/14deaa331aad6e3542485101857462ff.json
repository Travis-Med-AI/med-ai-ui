{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { concat } from 'lodash';\nimport { ExperimentStatus } from 'med-ai-common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/experiment.service\";\nimport * as i2 from \"../services/model.service\";\nimport * as i3 from \"../services/notification.service\";\nimport * as i4 from \"@angular/material/card\";\nimport * as i5 from \"@angular/cdk/drag-drop\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/flex-layout/extended\";\nimport * as i8 from \"@angular/material/icon\";\nimport * as i9 from \"@angular/flex-layout/flex\";\nimport * as i10 from \"@angular/material/button\";\nimport * as i11 from \"@angular/material/form-field\";\nimport * as i12 from \"@angular/material/select\";\nimport * as i13 from \"@angular/forms\";\nimport * as i14 from \"@angular/material/core\";\nimport * as i15 from \"@angular/material/progress-bar\";\nimport * as i16 from \"@angular/material/tooltip\";\n\nfunction ExperimentCardComponent_mat_icon_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\");\n    i0.ɵɵtext(1, \"expand_more\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ExperimentCardComponent_mat_icon_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\");\n    i0.ɵɵtext(1, \"expand_less\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ExperimentCardComponent_div_14_div_1_mat_form_field_1_mat_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const model_r11 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", model_r11.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", model_r11.image, \" \");\n  }\n}\n\nfunction ExperimentCardComponent_div_14_div_1_mat_form_field_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-form-field\", 11)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Model\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"mat-select\", 14);\n    i0.ɵɵtemplate(4, ExperimentCardComponent_div_14_div_1_mat_form_field_1_mat_option_4_Template, 2, 2, \"mat-option\", 15);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const models_r9 = ctx.ngIf;\n    const ctx_r8 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r8.modelControl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", models_r9);\n  }\n}\n\nfunction ExperimentCardComponent_div_14_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ExperimentCardComponent_div_14_div_1_mat_form_field_1_Template, 5, 2, \"mat-form-field\", 10);\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵelementStart(3, \"div\", 11)(4, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function ExperimentCardComponent_div_14_div_1_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return ctx_r12.startExperiment();\n    });\n    i0.ɵɵtext(5, \"Start Experiment\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function ExperimentCardComponent_div_14_div_1_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r14 = i0.ɵɵnextContext(2);\n      return ctx_r14.downloadResults();\n    });\n    i0.ɵɵtext(7, \"Download Results Early\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function ExperimentCardComponent_div_14_div_1_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r15 = i0.ɵɵnextContext(2);\n      return ctx_r15.getStats();\n    });\n    i0.ɵɵtext(9, \"Get Stats\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 1, ctx_r3.models$));\n  }\n}\n\nfunction ExperimentCardComponent_div_14_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"mat-progress-bar\", 17);\n    i0.ɵɵelementStart(2, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ExperimentCardComponent_div_14_div_2_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      return ctx_r16.stopExperiment();\n    });\n    i0.ɵɵtext(3, \"Stop Experiment\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", ctx_r4.experiment.progress * 100);\n  }\n}\n\nfunction ExperimentCardComponent_div_14_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function ExperimentCardComponent_div_14_div_3_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return ctx_r18.downloadResults();\n    });\n    i0.ɵɵtext(2, \"Download Results\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction ExperimentCardComponent_div_14_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r6.JSON.stringify(ctx_r6.stats), \" \");\n  }\n}\n\nfunction ExperimentCardComponent_div_14_mat_card_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"slice\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const study_r20 = ctx.$implicit;\n    i0.ɵɵproperty(\"cdkDragData\", study_r20)(\"cdkDragDisabled\", true)(\"matTooltip\", study_r20.seriesUid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(study_r20.seriesUid.length > 15 ? i0.ɵɵpipeBind3(2, 4, study_r20.seriesUid, 0, 15) + \"...\" : study_r20.seriesUid);\n  }\n}\n\nconst _c0 = function () {\n  return [\"studies\"];\n};\n\nfunction ExperimentCardComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ExperimentCardComponent_div_14_div_1_Template, 10, 3, \"div\", 6);\n    i0.ɵɵtemplate(2, ExperimentCardComponent_div_14_div_2_Template, 4, 1, \"div\", 6);\n    i0.ɵɵtemplate(3, ExperimentCardComponent_div_14_div_3_Template, 3, 0, \"div\", 6);\n    i0.ɵɵtemplate(4, ExperimentCardComponent_div_14_div_4_Template, 3, 1, \"div\", 6);\n    i0.ɵɵelementStart(5, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function ExperimentCardComponent_div_14_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return ctx_r21.deleteExperiment();\n    });\n    i0.ɵɵtext(6, \"Delete Experiment\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 8);\n    i0.ɵɵlistener(\"cdkDropListDropped\", function ExperimentCardComponent_div_14_Template_div_cdkDropListDropped_7_listener($event) {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return ctx_r23.drop($event);\n    })(\"cdkDropListEntered\", function ExperimentCardComponent_div_14_Template_div_cdkDropListEntered_7_listener() {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r24 = i0.ɵɵnextContext();\n      return ctx_r24.entered();\n    });\n    i0.ɵɵtemplate(8, ExperimentCardComponent_div_14_mat_card_8_Template, 3, 8, \"mat-card\", 9);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.experiment.status === ctx_r2.statuses.NEW || ctx_r2.experiment.status === ctx_r2.statuses.STOPPED);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.experiment.status === ctx_r2.statuses.RUNNING);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.experiment.status === ctx_r2.statuses.COMPLETED);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.stats);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"id\", ctx_r2.experiment.id.toString())(\"cdkDropListConnectedTo\", i0.ɵɵpureFunction0(7, _c0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.studies);\n  }\n}\n\nconst _c1 = function (a0, a1, a2) {\n  return {\n    \"running-card\": a0,\n    \"finished-card\": a1,\n    \"failed-card\": a2\n  };\n};\n\nexport let ExperimentCardComponent = /*#__PURE__*/(() => {\n  class ExperimentCardComponent {\n    constructor(experimentService, modelService, notificationService) {\n      this.experimentService = experimentService;\n      this.modelService = modelService;\n      this.notificationService = notificationService;\n      this.deleted = new EventEmitter();\n      this.JSON = JSON;\n      this.statuses = ExperimentStatus;\n      this.models$ = this.modelService.getModels();\n      this.modelControl = new FormControl();\n      this.expanded = false;\n    }\n\n    ngOnInit() {\n      this.experimentService.getStudiesByExperiment(this.experiment.id).subscribe(s => {\n        this.studies = s.payload;\n      });\n    }\n\n    expand() {\n      if (!this.expanded) {\n        this.expanded = true;\n        this.experimentService.getStudiesByExperiment(this.experiment.id).subscribe(s => {\n          this.studies = s.payload;\n        });\n      } else {\n        this.expanded = false;\n      }\n    }\n\n    drop(item) {\n      let ids = concat(this.selectedStudies, [item.item.data.id]); // if (this.experiment.type != item.item.data.type) {\n      //   this.notificationService.showNotification(`Experiment can only take type:${this.experiment.type}`)\n      //   return\n      // }\n\n      this.experimentService.addStudiesToExperiment(ids, this.experiment.id).subscribe(s => this.studies = s.payload);\n    }\n\n    entered() {\n      console.log('entered ', this.experiment.id);\n    }\n\n    startExperiment() {\n      this.experimentService.startExperiment(this.experiment.id, this.modelControl.value).subscribe(e => this.experiment = e);\n    }\n\n    stopExperiment() {\n      this.experimentService.stopExperiment(this.experiment.id).subscribe(e => this.experiment = e);\n    }\n\n    deleteExperiment() {\n      this.experimentService.deleteExperiment(this.experiment.id).subscribe(e => this.deleted.emit(true));\n    }\n\n    downloadResults() {\n      this.experimentService.getResults(this.experiment.id);\n    }\n\n    getStats() {\n      this.experimentService.getEvalStats(this.experiment.id).subscribe(s => this.stats = s);\n    }\n\n  }\n\n  ExperimentCardComponent.ɵfac = function ExperimentCardComponent_Factory(t) {\n    return new (t || ExperimentCardComponent)(i0.ɵɵdirectiveInject(i1.ExperimentService), i0.ɵɵdirectiveInject(i2.ModelService), i0.ɵɵdirectiveInject(i3.NotificationService));\n  };\n\n  ExperimentCardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ExperimentCardComponent,\n    selectors: [[\"app-experiment-card\"]],\n    inputs: {\n      experiment: \"experiment\",\n      selectedStudies: \"selectedStudies\"\n    },\n    outputs: {\n      deleted: \"deleted\"\n    },\n    decls: 15,\n    vars: 15,\n    consts: [[\"cdkDropList\", \"\", \"cdkDropListOrientation\", \"horizontal\", 3, \"id\", \"cdkDropListConnectedTo\", \"ngClass\", \"cdkDropListDropped\", \"cdkDropListEntered\"], [1, \"experiment-header\", 3, \"click\"], [\"mat-card-avatar\", \"\"], [1, \"folder-icon\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"space-between center\"], [\"mat-icon-button\", \"\"], [4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 1, \"full-width\", 3, \"click\"], [\"fxLayout\", \"row wrap\", \"fxLayoutGap\", \"16px\", \"cdkDropList\", \"\", \"cdkDropListOrientation\", \"horizontal\", 1, \"experiment-studies-container\", 3, \"id\", \"cdkDropListConnectedTo\", \"cdkDropListDropped\", \"cdkDropListEntered\"], [\"class\", \"study-card\", \"cdkDrag\", \"\", 3, \"cdkDragData\", \"cdkDragDisabled\", \"matTooltip\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"full-width\", 4, \"ngIf\"], [1, \"full-width\"], [\"mat-button\", \"\", \"color\", \"primary\", 1, \"full-width\", 3, \"click\"], [\"mat-button\", \"\", \"color\", \"accent\", 1, \"full-width\", 3, \"click\"], [3, \"formControl\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"mode\", \"determinate\", 3, \"value\"], [\"mat-button\", \"\", \"color\", \"warn\", 1, \"full-width\", 3, \"click\"], [\"mat-button\", \"\", 1, \"full-width\", 3, \"click\"], [\"cdkDrag\", \"\", 1, \"study-card\", 3, \"cdkDragData\", \"cdkDragDisabled\", \"matTooltip\"]],\n    template: function ExperimentCardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-card\", 0);\n        i0.ɵɵlistener(\"cdkDropListDropped\", function ExperimentCardComponent_Template_mat_card_cdkDropListDropped_0_listener($event) {\n          return ctx.drop($event);\n        })(\"cdkDropListEntered\", function ExperimentCardComponent_Template_mat_card_cdkDropListEntered_0_listener() {\n          return ctx.entered();\n        });\n        i0.ɵɵelementStart(1, \"mat-card-header\", 1);\n        i0.ɵɵlistener(\"click\", function ExperimentCardComponent_Template_mat_card_header_click_1_listener() {\n          return ctx.expand();\n        });\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"mat-icon\", 3);\n        i0.ɵɵtext(4, \"folder\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"mat-card-title\", 4)(6, \"span\");\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 5);\n        i0.ɵɵtemplate(9, ExperimentCardComponent_mat_icon_9_Template, 2, 0, \"mat-icon\", 6);\n        i0.ɵɵtemplate(10, ExperimentCardComponent_mat_icon_10_Template, 2, 0, \"mat-icon\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(11, \"mat-card-subtitle\");\n        i0.ɵɵtext(12);\n        i0.ɵɵpipe(13, \"date\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(14, ExperimentCardComponent_div_14_Template, 9, 8, \"div\", 6);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"id\", ctx.experiment.id.toString())(\"cdkDropListConnectedTo\", i0.ɵɵpureFunction0(10, _c0))(\"ngClass\", i0.ɵɵpureFunction3(11, _c1, ctx.experiment.status === ctx.statuses.RUNNING, ctx.experiment.status === ctx.statuses.COMPLETED, ctx.experiment.status === ctx.statuses.STOPPED));\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.experiment.name);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.expanded);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.expanded);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(13, 8, ctx.experiment.createdDate), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.expanded);\n      }\n    },\n    directives: [i4.MatCard, i5.CdkDropList, i6.NgClass, i7.DefaultClassDirective, i4.MatCardHeader, i4.MatCardAvatar, i8.MatIcon, i4.MatCardTitle, i9.DefaultLayoutDirective, i9.DefaultLayoutAlignDirective, i10.MatButton, i6.NgIf, i4.MatCardSubtitle, i11.MatFormField, i11.MatLabel, i12.MatSelect, i13.NgControlStatus, i13.FormControlDirective, i6.NgForOf, i14.MatOption, i15.MatProgressBar, i9.DefaultLayoutGapDirective, i5.CdkDrag, i16.MatTooltip],\n    pipes: [i6.DatePipe, i6.AsyncPipe, i6.SlicePipe],\n    styles: [\".experiment-header{width:100%;cursor:pointer}.mat-card-header-text{width:100%}.mat-card-avatar{height:5rem!important;width:5rem!important}.folder-icon.mat-icon{height:5rem;width:5rem;font-size:5rem}.study-card{width:10rem;margin:.5rem;height:1.5rem;overflow:hidden}.experiment-studies-container{max-height:8rem;overflow-y:auto}.finished-card{background-color:#c8e6c9}.running-card{background-color:#bbdefb}.failed-card{background-color:#ffcdd2}.full-width{width:100%}\\n\"],\n    encapsulation: 2\n  });\n  return ExperimentCardComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}